<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('./partials/head'); -%>
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
    <%- include('./partials/header',{check:false}); -%>
    
    
    <div class="container rounded bg-white mt-5 mb-5">
        <form class="row" method="post" enctype="multipart/form-data">
            <div class="col-md-3 border-right">
                <div class="d-flex flex-column align-items-center text-center p-3 py-5" id="avatar-img"style="position: relative;">
                    <div style="width: 150px;height: 150px; border-radius: 50%; overflow: hidden;display: flex;align-items: center;">
                        <img  width="100%" height="auto" class="rounded-circle-a"
                        src="<%= user.avatar%>" >
                    </div>
                    <span class="font-weight-bold"><%= user.name%></span>
                    <span class="text-black-50"><%= user.email%></span><span> </span>
                    <i class="bi bi-pencil-fill" style="position: absolute;">
                        <input type="file" name="avatar" id="" style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;opacity: 0;cursor: pointer;">
                    </i>
                </div>
                <div id="btn-image-save" style="background: linear-gradient(135deg, #ce4be8 0%, #207ce5 100%);text-align: center; color:white;padding: 8px 12px;margin-bottom: 20px;border-radius: 10px;display: none;cursor: pointer;">Lưu hình ảnh</div>
                <div>
                    Số khóa học đã tham gia: <span style="color: #ce4be8;"><%= quantity %></span> 
                </div>
                <a href="/profile/course">Quản lí khóa học</a>
            </div>
            <div class="col-md-5 border-right">
                <div class="p-3 py-5">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="text-right">Thông tin cá nhân</h4>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-6"><label class="labels">Tên</label><input type="text" class="form-control" style="width: 100%;" value="<%= user.name%>"></div>
                        
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <label class="labels">Role</label>
                            <input type="text" 
                                    class="form-control" 
                                    placeholder="enter phone number" 
                                    value="<% if (user.role==1){ %>Giáo Viên
                                    <% } else{ %>
                                        Học sinh
                                        <% }%>
                                    ">
                        </div>
                        <div class="col-md-12">
                            <label class="labels">Email</label>
                            <input type="text" class="form-control" placeholder="Email" value="<%= user.email%>">
                        </div>
                        <div class="col-md-12">
                            <label class="labels">Tel</label>
                            <input type="text" class="form-control" placeholder="Số Điện Thoại" value="<%= user.tel%>">
                        </div>
                        <div class="col-md-12">
                            <label class="labels">Tuổi</label>
                            <input type="text" class="form-control" placeholder="Tuổi" value="<%= user.age%>">
                        </div>
                        <div class="col-md-12">
                            <label class="labels">Thông tin thêm</label>
                            <input type="text" class="form-control" placeholder="Mô tả" value="<%= user.des%>">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label class="labels">Country</label>
                            <input type="text" class="form-control" placeholder="country" value="Việt Nam">
                        </div>
                        <div class="col-md-6"><label class="labels">State/Region</label><input type="text" class="form-control" value="" placeholder="state"></div>
                    </div>
                    <div class="mt-5 text-center">
                        <button class="btn btn-primary profile-button" type="submit">Save Profile</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-3 py-5">
                    <div class="d-flex justify-content-between align-items-center experience"><span>Edit Experience</span><span class="border px-3 p-1 add-experience"><i class="fa fa-plus"></i>&nbsp;Experience</span></div><br>
                    <div class="col-md-12"><label class="labels">Experience in Designing</label><input type="text" class="form-control" placeholder="experience" value=""></div> <br>
                    <div class="col-md-12"><label class="labels">Additional Details</label><input type="text" class="form-control" placeholder="additional details" value=""></div>
                </div>
            </div>
        </form>
    </div>
    </div>
    </div>


    <%- include('./partials/footer'); -%>
    <input type="hidden" name="userId" value="<%= user._id%>">


<!-- loader -->
<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery-migrate-3.0.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.easing.1.3.js"></script>
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.stellar.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/jquery.animateNumber.min.js"></script>
<script src="/js/bootstrap-datepicker.js"></script>
<script src="/js/scrollax.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="/js/main.js"></script>
<script src="/js/thang_custom.js"></script>
<script>
    document.addEventListener('DOMContentLoaded',()=>{
        
        const imgEle=document.querySelector('.rounded-circle-a')
        const inputEle=document.querySelector('input[type="file"]')
        const btnSaveImage=document.querySelector('#btn-image-save')
        let srcImg;

        inputEle.addEventListener('change',(e)=>{
            btnSaveImage.style.display='block'
            if(srcImg){
                URL.revokeObjectURL(srcImg)
            }
            console.log(e.target.files[0])
            srcImg=URL.createObjectURL(e.target.files[0])
            imgEle.src=srcImg
        })

        btnSaveImage.addEventListener('click',(e)=>{
            console.log(inputEle.files[0])
            var data = new FormData()
            data.append('avatar',inputEle.files[0])
            fetch(`${window.location.origin}/profile/me/avatar`,
            {
                method: "POST",
                body: data
            })
            .then(res=>res.json())
            .then(res=>{
                if(res.success){
                    btnSaveImage.style.display='none'
                    showToast('','Thay đổi avatar thành công',2)
                }
            })
            .catch(function(res){ console.log(res) })
        })
    })
</script>
</body>
</html>